<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>VAPECOIN • Valor de Canje</title>

<style>
body{
  margin:0;
  font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial;
  background:transparent;
}
.wrap{
  display:flex;
  justify-content:center;
  padding:14px;
}
.card{
  width:100%;
  max-width:900px;
  background:#fff;
  border-radius:18px;
  border:1px solid #e9eef5;
  box-shadow:0 10px 24px rgba(0,0,0,.10);
  overflow:hidden;
}
.top{
  background:linear-gradient(135deg,#0b76ff 0%, #08338f 100%);
  color:#fff;
  padding:18px;
  display:flex;
  align-items:center;
  gap:14px;
}
.logo{
  width:54px;
  height:54px;
  border-radius:50%;
  background:rgba(0,0,0,.25);
  display:flex;
  align-items:center;
  justify-content:center;
  font-weight:900;
  font-size:28px;
}
.title{
  font-weight:900;
  font-size:22px;
}
.subtitle{
  font-size:14px;
  opacity:.9;
}
.price{
  margin-left:auto;
  text-align:right;
}
.price-main{
  font-weight:900;
  font-size:22px;
}
.price-base{
  font-size:14px;
  opacity:.9;
}
.mid{
  padding:16px 18px;
}
.chart{
  background:#f6f8fc;
  border:1px solid #e9eef5;
  border-radius:16px;
  padding:10px;
}
svg{
  width:100%;
  height:200px;
  display:block;
}
.footer{
  padding:12px 18px 16px;
  font-size:12px;
  color:#6b778c;
}
.footer strong{color:#2b3445;}
</style>
</head>

<body>
<div class="wrap">
  <div class="card">
    <div class="top">
      <div class="logo">V</div>
      <div>
        <div class="title">VAPECOIN</div>
        <div class="subtitle" id="label">Valor de canje interno</div>
      </div>
      <div class="price">
        <div class="price-main" id="mainPrice">—</div>
        <div class="price-base" id="basePrice">Base: —</div>
      </div>
    </div>

    <div class="mid">
      <div class="chart">
        <svg viewBox="0 0 900 200" preserveAspectRatio="none">
          <path id="area" fill="rgba(11,118,255,.18)"></path>
          <path id="line" fill="#0b76ff" stroke="#0b76ff" stroke-width="3.5"></path>
        </svg>
      </div>
    </div>

    <div class="footer">
      <div><strong>*</strong> No es precio de mercado. Valor de canje interno válido solo en PERUVAPEA.</div>
      <div style="margin-top:6px">Actualizado: <span id="updatedAt">—</span></div>
    </div>
  </div>
</div>

<script>
const RATE_URL = "https://peruvapea-svg.github.io/vapecoin-widget/vapecoin-rate.json";

const elLabel = document.getElementById("label");
const elMain  = document.getElementById("mainPrice");
const elBase  = document.getElementById("basePrice");
const elUpd   = document.getElementById("updatedAt");
const pathLine = document.getElementById("line");
const pathArea = document.getElementById("area");

function fmtUSD(v){
  return new Intl.NumberFormat("en-US",{
    style:"currency",
    currency:"USD",
    maximumFractionDigits:6
  }).format(v);
}

function drawChart(base){
  const w=900,h=200,p=12;
  let d="",a="";
  let prev=base;

  for(let i=0;i<40;i++){
    const step=(Math.random()*2-1)*0.01;
    prev=Math.max(base*0.5,Math.min(base*1.5,prev*(1+step)));

    const x=p+(w-2*p)*(i/39);
    const y=(h-p)-(h-2*p)*((prev-base*0.5)/(base));

    d+=i===0?`M${x},${y}`:` L${x},${y}`;
    if(i===0)a=`M${x},${h-p} L${x},${y}`;
    else a+=` L${x},${y}`;
  }
  a+=` L${w-p},${h-p} Z`;

  pathLine.setAttribute("d",d);
  pathArea.setAttribute("d",a);
}

async function init(){
  const res = await fetch(RATE_URL,{cache:"no-store"});
  const cfg = await res.json();

  const base = Number(cfg.base_usd || 0.01);
  const shown = base*(1+(Math.random()*2-1)*(cfg.range_pct ?? 0.5));

  elLabel.textContent = cfg.label || "Valor de canje interno";
  elMain.textContent  = `1 VAPECOIN = ${fmtUSD(shown)}`;
  elBase.textContent  = `Base: ${fmtUSD(base)}`;
  elUpd.textContent   = cfg.updated_at || "—";

  drawChart(base);
}

init();
</script>
</body>
</html>
